window.addEventListener('load', async () => {
  const response = {"lastPushedRepos":{"repositories":{"edges":[{"node":{"name":"cwt","url":"https://github.com/Zemke/cwt","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UyNzI=","color":"#F18E33","name":"Kotlin"},"size":412830},{"node":{"id":"MDg6TGFuZ3VhZ2UyODc=","color":"#2b7489","name":"TypeScript"},"size":245485},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":105640},{"node":{"id":"MDg6TGFuZ3VhZ2UxNTg=","color":"#b07219","name":"Java"},"size":60686}]}}},{"node":{"name":"waaas","url":"https://github.com/Zemke/waaas","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDU=","color":"#3572A5","name":"Python"},"size":12230},{"node":{"id":"MDg6TGFuZ3VhZ2UxMzk=","color":"#89e051","name":"Shell"},"size":163}]}}},{"node":{"name":"tippspiel2","url":"https://github.com/Zemke/tippspiel2","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UyNzI=","color":"#F18E33","name":"Kotlin"},"size":166063},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":64494},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":29902},{"node":{"id":"MDg6TGFuZ3VhZ2UxNTg=","color":"#b07219","name":"Java"},"size":4301}]}}},{"node":{"name":"instant-smart-quotes","url":"https://github.com/Zemke/instant-smart-quotes","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":24262},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":499},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":374}]}}},{"node":{"name":"just","url":"https://github.com/Zemke/just","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":101047},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":18853},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":1821}]}}},{"node":{"name":"zemke.github.io","url":"https://github.com/Zemke/zemke.github.io","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":22759},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":20206},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":5197},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDE=","color":"#701516","name":"Ruby"},"size":669}]}}},{"node":{"name":"khttp","url":"https://github.com/Zemke/khttp","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UyNzI=","color":"#F18E33","name":"Kotlin"},"size":150508}]}}},{"node":{"name":"notes","url":"https://github.com/Zemke/notes","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":6322},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":3984}]}}},{"node":{"name":"cwt-qualifiers","url":"https://github.com/Zemke/cwt-qualifiers","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":27453},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":2262},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":1782}]}}},{"node":{"name":"cwt-binary","url":"https://github.com/Zemke/cwt-binary","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNTE=","color":"#4F5D95","name":"PHP"},"size":18999}]}}},{"node":{"name":"ddns-endpoint","url":"https://github.com/Zemke/ddns-endpoint","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDU=","color":"#3572A5","name":"Python"},"size":884}]}}},{"node":{"name":"react-native-peerjs","url":"https://github.com/Zemke/react-native-peerjs","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxMzk=","color":"#89e051","name":"Shell"},"size":371},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":105}]}}},{"node":{"name":"dotfiles","url":"https://github.com/Zemke/dotfiles","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxMzk=","color":"#89e051","name":"Shell"},"size":729},{"node":{"id":"MDg6TGFuZ3VhZ2U1Njk=","color":"#199f4b","name":"Vim script"},"size":273}]}}},{"node":{"name":"convert-links","url":"https://github.com/Zemke/convert-links","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":4404}]}}},{"node":{"name":"http-mock","url":"https://github.com/Zemke/http-mock","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":3081}]}}},{"node":{"name":"ipfs-chat","url":"https://github.com/Zemke/ipfs-chat","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":10362},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":1808},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":1708}]}}},{"node":{"name":"twitch-streams-webhook","url":"https://github.com/Zemke/twitch-streams-webhook","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":7124}]}}},{"node":{"name":"tippspiel","url":"https://github.com/Zemke/tippspiel","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNTE=","color":"#4F5D95","name":"PHP"},"size":90861},{"node":{"id":"MDg6TGFuZ3VhZ2UyODc=","color":"#2b7489","name":"TypeScript"},"size":29344},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":22783},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":17934}]}}},{"node":{"name":"moment-timezone","url":"https://github.com/Zemke/moment-timezone","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":5902218}]}}},{"node":{"name":"starter-laravel-angular","url":"https://github.com/Zemke/starter-laravel-angular","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNTE=","color":"#4F5D95","name":"PHP"},"size":88513},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":9978},{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":7091},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTg=","color":null,"name":"ApacheConf"},"size":553}]}}},{"node":{"name":"starter-node-angular","url":"https://github.com/Zemke/starter-node-angular","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":6399},{"node":{"id":"MDg6TGFuZ3VhZ2U0MTc=","color":"#e34c26","name":"HTML"},"size":698},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":26}]}}},{"node":{"name":"nachuriken","url":"https://github.com/Zemke/nachuriken","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNTg=","color":"#b07219","name":"Java"},"size":21441}]}}},{"node":{"name":"p2p-tictactoe","url":"https://github.com/Zemke/p2p-tictactoe","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":5589},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":1778},{"node":{"id":"MDg6TGFuZ3VhZ2UxMzk=","color":"#89e051","name":"Shell"},"size":35}]}}},{"node":{"name":"irc-snooper","url":"https://github.com/Zemke/irc-snooper","languages":{"edges":[{"node":{"id":"MDg6TGFuZ3VhZ2UxNDA=","color":"#f1e05a","name":"JavaScript"},"size":3467},{"node":{"id":"MDg6TGFuZ3VhZ2UzMDg=","color":"#563d7c","name":"CSS"},"size":151}]}}}]}},"pinnedRepos":{"pinnedItems":{"nodes":[{"id":"MDEwOlJlcG9zaXRvcnk3ODU0OTQw","name":"cwt","description":"Crespoâ€™s Worms Tournament (CWT) is the most prestigious tournament of Team17â€™s strategy game title Worms Armageddon held annually since 2002.","url":"https://github.com/Zemke/cwt","homepageUrl":"https://cwtsite.com/","object":{"text":"![CI](https://github.com/zemke/cwt/workflows/CI/badge.svg)\n![release](https://img.shields.io/github/v/release/zemke/cwt.svg)\n\n# Crespoâ€™s Worms Tournament\n\nCrespoâ€™s Worms Tournament (CWT) is the most prestigious tournament of Team17â€™s strategy game title Worms Armageddon held annually since 2002.\n\n[Wiki](http://worms2d.info/Crespo%27s_Worms_Tournament)\n"}},{"id":"MDEwOlJlcG9zaXRvcnkyMzA1MzY5MzI=","name":"just","description":"Richly featured Instant Messenger with focus on just chatting.","url":"https://github.com/Zemke/just","homepageUrl":"https://just.zemke.io","object":{"text":"# Just\n\nRichly featured Instant Messenger with focus on just chatting.\n\nThereâ€™s no registration, no syncing with your address book or sharing your phone number. Youâ€™re anonymously identified by your personal unique Just code that you share only with the people you want to contact with.\n\nPeer-to-peer video and voice calls, GIF sharing, image sharing, camera support, advanced link sharing, share from other Apps (on Android), location sharing, message reactions (tapbacks), Markdown inline and block code formatting, large emoji, Push notifications (on Android and Desktop) and much more.\n\n<img src=\"https://user-images.githubusercontent.com/3391981/81665264-cb6da600-9440-11ea-9dc0-497ef32f2007.png\" width=\"350\">\n"}},{"id":"MDEwOlJlcG9zaXRvcnkxMTY0OTA5NjA=","name":"tippspiel2","description":"Multitenant betting game being initially developed for the World Cup 2018 in Russia.","url":"https://github.com/Zemke/tippspiel2","homepageUrl":"","object":{"text":"# Tippspiel2\n\nThe epic successor of [Zemke/tippspiel](https://github.com/Zemke/tippspiel).\n\n## Run\n\n```sh\nmvn clean install && mvn spring-boot:run -pl tippspiel2-spring\n```\n\n[http://localhost:8080/](http://localhost:8080/)\n\n## Technologies\n\n* Spring Boot\n* Kotlin\n* Ember\n* ES6\n* PostgreSQL\n* Bulma\n\n## Features\n\n* Standings\n* Place bets\n* See bets by user\n* See bets by game\n* football-data.org API\n* Bet on champion\n* Simultaneous betting communities\n* ~~Simultaneous competitions~~ \n\n## Impressions\n\n> ![admin](https://user-images.githubusercontent.com/3391981/81667518-a6c6fd80-9443-11ea-9a56-12316b0285d5.png)\n\n> ![bets](https://user-images.githubusercontent.com/3391981/81667520-a75f9400-9443-11ea-8331-a4071f15a1b8.png)\n\n> ![landscape](https://user-images.githubusercontent.com/3391981/81667521-a7f82a80-9443-11ea-9a81-2e23846cbb2e.png)\n\n> ![portrait](https://user-images.githubusercontent.com/3391981/81667524-a7f82a80-9443-11ea-917a-da0ad578dc87.png)\n"}},{"id":"MDEwOlJlcG9zaXRvcnk2NDE2NjQ5Mw==","name":"instant-smart-quotes","description":"Chromeâ€™s most popular extension to replace typewriter quotes, apostrophes, ellipses and dashes with their typographically correct counterparts as you type.","url":"https://github.com/Zemke/instant-smart-quotes","homepageUrl":"https://chrome.google.com/webstore/detail/instant-smart-quotes/dddflkfjemblhfmjdlmmilapbkdaabcj","object":{"text":"# Instant Smart Quotes\n\nReplace typewriter quotes, apostrophes, ellipses and dashes with their typographically correct counterparts as you type.\nInstant Smart Quotes is the last extension you will need to write beautiful typographically correct texts.\n\n- Support for over 50 languages\n- Quickly enable and disable the instant replacements from the toolbar\n- Quickly change the language from the toolbar\n- All settings are saved per page and synched across all of your devices\n- Text in `backticks` will be ignored in favor of Markdown\n\nDepending on which language you have set, the following chars will be replaced for language-specific replacements (comma-separated):\n', \", >>, <<\n\nChars that will be replaced for no matter which language are the following (comma-separated):\n', --, ---, ...\n\nThis website is a nice manual for English punctuation guidelines:\nhttp://www.thepunctuationguide.com/\n\nSources of which quotes to be used for which language:\nhttps://en.wikipedia.org/wiki/Quotation_mark#Summary_table\nhttp://www.witch.westfalen.de/csstest/quotes/quotes.html\n\n`\"Don't be dumb\"`, â€œyouâ€™re using Instant Smart Quotesâ€. âœï¸\n\n![Instant Smart Quotes preview](https://user-images.githubusercontent.com/3391981/81667198-43d56680-9443-11ea-99db-0effcc5cca08.gif)\n\n"}},{"id":"MDEwOlJlcG9zaXRvcnkyNTEzNzc4NTg=","name":"waaas","description":"WAaaS â€” Worms Armageddon as a Service","url":"https://github.com/Zemke/waaas","homepageUrl":"https://waaas.zemke.io/","object":{"text":"# Worms Armageddon as a Service\n\nWAaaS is an API to [zemke/docker-wa](https://hub.docker.com/r/zemke/docker-wa) returning data from replay files in JSON format.\n\n## Visualization example\n\nScreen shot from https://cwtsite.com/games/1602\n\n![Data visualization example](https://user-images.githubusercontent.com/3391981/81668501-0e317d00-9445-11ea-9206-954444ffd97b.png)\n"}},{"id":"MDEwOlJlcG9zaXRvcnkzMTQ2NzY1NA==","name":"starter-laravel-angular","description":"Laravel and AngularJS Starter Application Boilerplate featuring Laravel 5.3 and AngularJS 1.5.8","url":"https://github.com/Zemke/starter-laravel-angular","homepageUrl":"https://starter-laravel-angular.herokuapp.com","object":{"text":"ðŸ’ *Zemke/starter-laravel-angular has been upgraded to AngularJS 1.5.8.*\n\nðŸ’ *Zemke/starter-laravel-angular has been upgraded to Laravel 5.3. You can pull the changes and run* `rm composer.lock && composer install --prefer-dist --no-scripts` *to merge the upgrade.*\n\n# Laravel and AngularJS Starter Application\n\nThis is a repo for a starter application for a Single Page Application featuring the modern Laravel PHP framework and Googleâ€™s acclaimed front-end framework AngularJS. Just download and install and you have a good foundation for building any application.\n\n## Features!\n\n- Single Page Application\n  - HTML5 mode URLs\n  - Optimized Laravel and AngularJS routes\n    - You kind of donâ€™t need to care about routes, they work automatically as you add new views. Still allows for flexibility if you plan any special routes.\n- Authentication!\n  - Flexible, extensible, clean\n  - Token-based ([tymondesigns/jwt-auth](https://github.com/tymondesigns/jwt-auth))\n  - Persistent local storage\n- Laravel Elixir readily configured\n  - Versioning of CSS and JS files (cache busting)\n  - CSS and JS files will be included automatically\n- A whole ready CRUD architecture\n- Comes with Bootstrap and AngularJS configured to work together at their best\n- And more... have a try!\n\n## Installation\n```\ngit clone https://github.com/Zemke/starter-laravel-angular.git\n```\n```\ncomposer install --prefer-dist\n```\n```\nnpm install\n```\n\n### Database setup\n\nEdit `.env.example` according to your environment and save as `.env`.\nAn application key can be generates with the command `php artisan key:generate`.\n\nRun these commands to create the tables within the database you have already created.\n\n```\nphp artisan migrate:install\n```\n```\nphp artisan migrate:refresh\n```\n\nIf you get an error like a `PDOException` try editing your `.env` file and change `DB_HOST=localhost` to `DB_HOST=127.0.0.1`. If that doesnâ€™t work, file an issue on GitHub, I will be glad to help.\nSource: http://stackoverflow.com/a/20733001\n\n## Run\n\nTo provide the JS and CSS files and to keep track of changes to these files:\n```\ngulp && gulp watch\n```\n\nTo start the PHP built-in server:\n```\nphp -S localhost:8080 -t public/\n```\n\nNow you can browse the site  [http://localhost:8080](http://localhost:8080). ðŸ™Œ\n\n## Requirements\n\n- PHP >= 5.4\n- Composer\n- Gulp\n- NPM\n- MySQL\n\n## Heroku deployment\n\n### Unignore some files\n\nYou should remove `.env` and `composer.lock` from `.gitignore`.\n\n#### .env\n\nSet up your `.env` file like described in â€œDatabase setupâ€ above.\n\n### Heroku buildpacks\n\nYou will need to add custom buildpacks for Heroku. Create `.buildpacks` and paste:\n\n```\nhttps://github.com/heroku/heroku-buildpack-php\nhttps://github.com/heroku/heroku-buildpack-nodejs\n```\n\n### Procfile\n\n```\nweb: vendor/bin/heroku-php-apache2 public/\n```\n\n### NPM config\n\nYour `package.json` should be changed to this:\n\n```json\n{\n    \"private\": true,\n    \"devDependencies\": {\n        \"gulp\": \"^3.8.8\"\n    },\n    \"dependencies\": {\n        \"laravel-elixir\": \"^3.0.0\",\n        \"gulp\": \"^3.8.8\"\n    },\n    \"scripts\": {\n        \"postinstall\": \"gulp\"\n    }\n}\n```\n\nThe `scripts` `postinstall` part is the important here, this will generate the resources like JS and CSS files.\n\nHave fun! Any feedback is welcome. Use [Issues](https://github.com/Zemke/starter-laravel-angular/issues) or [Twitter](https://twitter.com/FlorianZemke). My Twitter handle is @FlorianZemke. Iâ€™m looking forward to talk to you.\n\n![Laravel](https://cloud.githubusercontent.com/assets/3391981/6683259/2e914726-cc84-11e4-856c-bb26bda733a0.png)\n![AngularJS](https://cloud.githubusercontent.com/assets/3391981/6683229/9e0ea694-cc83-11e4-9b2e-59524dafd069.jpg)\n"}}]}}};
  createWorkSection(response.pinnedRepos.pinnedItems.nodes);
  createSpecsSection(response.lastPushedRepos.repositories.edges);
});

function createSpecsSection(repos) {
  const data = repos
    .flatMap(repo => repo.node.languages.edges)
    .reduce((acc, curr) => {
      const existing = acc.find(elem => elem.node.id === curr.node.id);
      if (!!existing) {
        existing.size += curr.size;
      } else {
        acc.push(curr);
      }
      return acc;
    }, [])
    .filter(({size}) => size >= 8000)
    .sort((a, b) => b.size - a.size)
    .map(elem => ({
      language: elem.node,
      size: elem.size,
      repos: repos
        .filter(repo => !!repo.node.languages.edges
          .find(lang => lang.node.id === elem.node.id))
        .map(({node}) => ({name: node.name, url: node.url}))
    }), []);
  document.getElementById('specsContainer').append(...data
    .map(elem => {
      const div = document.createElement('div');
      const h3 = document.createElement('h3');
      h3.textContent = elem.language.name;
      div.appendChild(h3);
      const repoLinkElements = elem.repos.flatMap((repo, idx, arr) => {
        const a = document.createElement('a');
        a.href = repo.url;
        a.target = '_blank';
        a.textContent = repo.name;
        if (idx + 1 !== arr.length) {
          return [a, document.createTextNode(', ')]
        }
        return a;
      });
      const repoLinkContainer = document.createElement('div');
      repoLinkContainer.classList.add('linkContainer');
      repoLinkContainer.append(...repoLinkElements);
      div.appendChild(repoLinkContainer);
      div.style.borderLeftColor = elem.language.color;
      return div;
    }));
}

function createWorkSection(pinnedRepos) {
  const nameAssoc = { // github repo name to localization
    'cwt': 'Crespoâ€™s Worms Tournament',
    'instant-smart-quotes': "Instant Smart Quotes",
    'tippspiel2': "Tippspiel 2",
    'just': "Just",
    'starter-laravel-angular': 'Starter Laravel Angular',
    'starter-node-angular': "Starter Node Angular",
    'waaas': "WAaaS",
    'zemke.github.io': "Zemke.IO",
  };

  const imgAssoc = { // github repo id to background image
    'MDEwOlJlcG9zaXRvcnk3ODU0OTQw': '/images/cwt.png',
    'MDEwOlJlcG9zaXRvcnk2NDE2NjQ5Mw==': "/images/ism.jpg",
    'MDEwOlJlcG9zaXRvcnkxMTY0OTA5NjA=': "/images/tippspiel.png",
    'MDEwOlJlcG9zaXRvcnkyMzA1MzY5MzI=': "/images/just.png",
  };

  const fallbackImages = ['/images/opensource.jpg', '/images/job.png'];
  let lastFallbackImageIdx = 1;

  function createWorkElement(res) {
    const div = document.createElement('div');
    let img;
    if (imgAssoc[res.id]) {
      img = imgAssoc[res.id];
    } else {
      lastFallbackImageIdx = lastFallbackImageIdx === 1 ? 0 : 1;
      img = fallbackImages[lastFallbackImageIdx];
    }
    // RGB is SCSS $main (#393D3F)
    div.style.backgroundImage = `radial-gradient(rgba(57, 61, 63, .4), rgba(57, 61, 63, .9)), url("${img}")`;
    div.classList.add('work');
    const h3 = document.createElement('h3');
    h3.innerText = nameAssoc[res.name] || res.name;
    div.appendChild(h3);
    return div;
  }

  function closeWorkOverlay(overlayDiv) {
    overlayDiv.remove();
    window.history.pushState(null, null, "/");
  }

  function createWorkOverlay(res) {
    const overlayDiv = document.createElement('div');
    overlayDiv.classList.add('work-description', 'on');
    const textDiv = document.createElement('div');
    textDiv.classList.add('text');
    const closeButtonElement = document.createElement('i');
    closeButtonElement.classList.add('fa', 'fa-5x', 'fa-times');
    closeButtonElement.addEventListener('click', () => closeWorkOverlay(overlayDiv));
    document.addEventListener('click', e =>
      e.target.classList.contains('work-description') && e.target.classList.contains('on') && closeWorkOverlay(overlayDiv));
    document.addEventListener('keydown', e => e.key === 'Escape' && closeWorkOverlay(overlayDiv));
    overlayDiv.appendChild(textDiv);
    textDiv.innerHTML = markyMarkdown(res.object.text, {highlightSyntax: false});
    textDiv.querySelectorAll('a > svg.octicon.octicon-link').forEach(elem => elem.remove());
    const shortDescription = document.createElement('div');
    shortDescription.classList.add('shortDescription');
    shortDescription.textContent = res.description;
    const externalLinks = document.createElement('div');
    externalLinks.classList.add('externalLinks');
    let linkListHtml = `<a target="_blank" href="${res.url}">View on GitHub</a>`;
    if (!!res.homepageUrl) {
      linkListHtml += `&nbsp;&bull;&nbsp;<a target="_blank" href="${res.homepageUrl}">View in Production</a>`
    }
    externalLinks.innerHTML = linkListHtml;
    textDiv.prepend(externalLinks);
    textDiv.prepend(shortDescription);
    textDiv.prepend(closeButtonElement);
    return overlayDiv;
  }

  const elements = pinnedRepos.map(res => {
    const workDiv = createWorkElement(res);
    if (res.object && res.object.text) {
      workDiv.addEventListener('click', () => {
        window.history.pushState(null, null, `?work=${res.name}#works`);
        workDiv.after(createWorkOverlay(res))
      });
    }
    return workDiv;
  });

  document.getElementById('worksContainer').append(...elements);

  const searchedWorkOverlay = new URLSearchParams(window.location.search).get('work');
  if (new URLSearchParams(window.location.search).get('work')) {
    document.getElementById('worksContainer').append(
      createWorkOverlay(pinnedRepos.find(res => res.name === searchedWorkOverlay)));
  }
}
